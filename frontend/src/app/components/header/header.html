<header class="header">
  <!-- ÙŠØ³Ø§Ø±: Ø§Ù„Ø´Ø¹Ø§Ø± -->
  <a routerLink="/" class="logo" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
    Pouchet
  </a>

  <!-- ÙˆØ³Ø·/ÙŠÙ…ÙŠÙ†: Ø±ÙˆØ§Ø¨Ø· Ø£Ø³Ø§Ø³ÙŠØ© -->
  <nav class="nav" [class.open]="mobileOpen()">
    <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>

    <!-- Ø±Ø§Ø¨Ø· Admin ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø¯ÙˆØ± Admin -->
    <ng-container *ngIf="user$ | async as u">
      <a *ngIf="u?.role === 'admin'" routerLink="/admin" routerLinkActive="active">Admin</a>
    </ng-container>
  </nav>

  <!-- ÙŠÙ…ÙŠÙ†: Ø³Ù„Ø© + Ø­Ø§Ù„Ø© Ø§Ù„Ø¶ÙŠÙ/Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div class="right">

    <!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø¯Ø§Ø¦Ù…Ù‹Ø§ -->
    <a class="nav-cart" routerLink="/cart" aria-label="Cart">
      <span class="icon" aria-hidden="true">ðŸ‘œ</span>
      <span class="badge" *ngIf="(count$ | async) as c" [class.hide]="!c">{{ c }}</span>
    </a>
    

    <!-- Ø¶ÙŠÙ -->
    <ng-container *ngIf="!(user$ | async); else loggedIn">
      <a class="btn ghost" routerLink="/login">Sign in</a>
      <a class="btn primary" routerLink="/register">Register</a>
    </ng-container>

    <!-- Ù…Ø³Ø¬Ù‘Ù„ -->
    <ng-template #loggedIn>
      <div class="userbox">
        <ng-container *ngIf="user$ | async as u">
          <span class="role" [class.admin]="u.role==='admin'">{{ u.role }}</span>
          <button class="avatar" (click)="toggleMenu()" aria-haspopup="menu" [attr.aria-expanded]="menuOpen()">
            {{ initial(u.email) }}
          </button>

          <div class="menu" *ngIf="menuOpen()" role="menu">
            <div class="info">
              <div class="email">{{ u.email }}</div>
              <div class="muted">Signed in</div>
            </div>

            <!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ù„Ø¬Ù…ÙŠØ¹ -->
            <a routerLink="/profile" routerLinkActive="active" role="menuitem" (click)="closeMenu()">Profile</a>

            <!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ù…Ù† -->
            <a *ngIf="u.role==='admin'" routerLink="/admin" role="menuitem" (click)="closeMenu()">Admin</a>

            <button (click)="logout()" role="menuitem">Logout</button>
          </div>
        </ng-container>
      </div>
    </ng-template>

    <!-- Ø²Ø± Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
    <button class="hamburger" (click)="toggleMobile()" aria-label="Menu" [attr.aria-expanded]="mobileOpen()">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>
